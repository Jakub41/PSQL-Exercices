# PSQL EXERCISES

## Creation of a Database for a the School Portafolio

```sql
CREATE DATABASE School WITH OWNER postgres
```

## Creation of the tables

#### Students table

```sql
CREATE TABLE Students ( 
      student_id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
      "name" VARCHAR ( 225 ) NOT NULL,
      "surname" VARCHAR ( 225 ) NOT NULL,
      "email" TEXT NOT NULL UNIQUE,
      "dateOfBirth" TEXT NOT NULL
);
```

#### Student table with UUID 

https://www.postgresqltutorial.com/postgresql-uuid/

```sql
CREATE TABLE Students (
    _id uuid DEFAULT uuid_generate_v4 (),
    first_name VARCHAR(20) NOT NULL,
    last_name VARCHAR(20) NOT NULL,
    email VARCHAR(20) NOT NULL,
		date_of_birth DATE NOT NULL,
    PRIMARY KEY (_id)
);
```



#### Projects table with FOREIGN KEY student_id

```sql
CREATE TABLE projects (
	project_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	student_id INT,
	FOREIGN KEY ( student_id ) REFERENCES students ( student_id ) ON DELETE RESTRICT,
	"name" VARCHAR ( 50 ) UNIQUE NOT NULL,
	description VARCHAR ( 120 ) NULL,
	creation_date TEXT NOT NULL,
	repourl TEXT NULL,
	liveurl TEXT NULL 
)
```



## Inserting records

#### Inserting to students table

```sql
INSERT INTO students ( "name", surname, email, "dateOfBirth" )
VALUES
	( 'Adele', 'Jones', 'jones@email.com', '11/12/1969' ),
	( 'Riccardo', 'Cordileone', 'eamil@core.com', '12/05/1995' ),
	('Filippa', 'Adams', 'adams@ext.com', '02/04/1988'),
	('Rodrigo', 'Scolieri', 'scolio@asr.com', '03/05/1984'),
	('Beatrice', 'Scolari', 'any@email.com', '08/07/1998'),
	('Patrick', 'Loris', 'loris@txt.com', '31/10/1984')
```

### Inserting to projects table (student foreign key)

```sql
INSERT INTO projects ( "name", description, creation_date, repourl, liveurl, student_id )
VALUES
	( 'My SQL', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 1 ) 
	),
	( 'PSQL', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 1 ) 
	),
	( 'Anything', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 2 ) 
	),
	( 'PHP', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 2 ) 
	),
	( 'NODE', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 3 ) 
	),
	( 'Boostrap', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 5 ) 
	),
	( 'Ruby', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 5 ) 
	),
	( 'SHH', 'A project', '12/12/2019', 'GitHub', 'www', 
		( SELECT student_id FROM students WHERE student_id = 5 ) 
	)
```



#### Insert to projects table with foreign key as UUID

```sql
INSERT INTO projects ( "name", description, creation_date, repourl, liveurl, student_id )
VALUES
	( 'My SQL', 'A project', '2019-12-12', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '40d37376-562d-45c1-a199-85918cd547b4' ) 
	),
	( 'PSQL', 'A project', '2019-05-06', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '40d37376-562d-45c1-a199-85918cd547b4' ) 
	),
	( 'Anything', 'A project', '2018-12-02', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '0f88fcba-1c52-4fdf-9008-e1d5ec87ad0c' ) 
	),
	( 'PHP', 'A project', '2017-10-25', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '0f88fcba-1c52-4fdf-9008-e1d5ec87ad0c' ) 
	),
	( 'NODE', 'A project', '2019-02-20', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '0f88fcba-1c52-4fdf-9008-e1d5ec87ad0c' ) 
	),
	( 'Boostrap', 'A project', '2019-08-03', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '39cdf634-eb1b-4378-a988-c18022450674' ) 
	),
	( 'Ruby', 'A project', '2018-09-27', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '40f75fa4-ed6a-4295-86f8-2b47d3cb5ef8' ) 
	),
	( 'SHH', 'A project', '2019-02-20', 'GitHub', 'www', 
		( SELECT _id FROM students WHERE _id = '40f75fa4-ed6a-4295-86f8-2b47d3cb5ef8' ) 
	)
```





## Update records

#### Projects table

```sql
UPDATE projects set "name" = 'my new project', "liveurl" = 'http//' WHERE project_id = 3
```

#### Students table 

```sql
UPDATE students set "name" = 'Dino', "dateOfBirth" = '10/10/2000' WHERE student_id = 3
```

## Select records

#### Selecting all projects and emails asociated to

```sql
SELECT P
	.*,
	s.email 
FROM
	projects
	P JOIN students s ON s.student_id = P.student_id
```



#### Selecting students as fullname plus email

```sql
SELECT 
   "name" || ' ' || "surname" AS full_name,
   email
FROM 
   students;
```



#### Selecting records from projects plus student

```sql
SELECT P
	."name",
	P.description,
	P.creation_date,
	s."name" || ' ' || s.surname AS full_name,
	s."dateOfBirth",
	s.email
FROM students
s JOIN projects P ON P.student_id = s.student_id
```

#### Selecting with ORDER BY and LIMIT

```sql
SELECT P
	."name",
	P.description,
	P.creation_date,
	s."name" || ' ' || s.surname AS full_name,
	s."dateOfBirth",
	s.email
FROM students
s JOIN projects P ON P.student_id = s.student_id
ORDER BY P."name" ASC LIMIT 3
```



## Delete records

#### Projects table

```sql
DELETE FROM projects WHERE project_id = 4
```

 #### Student table 

```sql
DELETE FROM students WHERE student_id = 3
```

**Note** => Above query gave an error as was used `ON DELETE RESTRICTED`  on the projects table 

```bash
ERROR:  update or delete on table "students" violates foreign key constraint "projects_student_id_fkey" on table "projects"
DETAIL:  Key (student_id)=(3) is still referenced from table "projects".
, Time: 0.001000s
```



## Modify records

**Adding 2 extra collumns with timestamps**

```sql
ALTER TABLE STUDENTS ADD COLUMN created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE STUDENTS ADD COLUMN updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;

OR

ALTER TABLE projects
ADD COLUMN created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;
```

